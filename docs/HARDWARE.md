# STM32-Health-Band 硬件说明文档

<div align="center">

**详细的硬件设计和规格说明**

[硬件清单](#硬件清单) • [电路设计](#电路设计说明) • [PCB设计](#pcb设计要点) • [机械结构](#机械结构) • [测试验证](#测试与验证)

</div>

---

## 硬件清单

### 主控制器
- **STM32F103C8T6** 微控制器
  - ARM Cortex-M3 内核
  - 主频: 72MHz
  - Flash: 64KB
  - SRAM: 20KB
  - 封装: LQFP48

### 传感器模块

#### 1. MAX30102 心率血氧传感器
- **功能**: 心率检测、血氧饱和度检测、体温检测
- **通信接口**: IIC
- **工作电压**: 3.3V
- **功耗**: 典型值 < 1mW
- **检测原理**: 光电容积脉搏波描记法(PPG)
- **测量范围**: 
  - 心率: 60-100 BPM
  - 血氧饱和度: 70%-100%
  - 温度: -40°C ~ +85°C

#### 2. ADXL345 三轴加速度传感器
- **功能**: 计步检测、跌倒检测、运动状态监测
- **通信接口**: IIC
- **工作电压**: 3.3V
- **测量范围**: ±16g
- **分辨率**: 13位
- **采样率**: 最高3200Hz
- **功耗**: 典型值 145μA

### 显示模块
#### OLED显示屏 (SSD1306驱动)
- **分辨率**: 128×64像素
- **通信接口**: IIC
- **工作电压**: 3.3V
- **显示颜色**: 单色(蓝色/白色)
- **可视角度**: >160°
- **功耗**: 典型值 20mA

### 通信模块
#### ESP8266-01S WiFi模块
- **功能**: WiFi无线通信
- **工作频率**: 2.4GHz
- **通信接口**: UART
- **工作电压**: 3.3V
- **功耗**: 
  - 发送: 170mA
  - 接收: 50mA
  - 深度睡眠: 10μA
- **传输距离**: 室内约10-15米
- **支持协议**: 802.11 b/g/n

### 其他组件
- **蜂鸣器**: 无源蜂鸣器，用于报警提示
- **电源模块**: 3.3V稳压电路
- **电池**: 锂电池3.7V (建议容量≥300mAh)

## 电路设计说明

### 电源设计
```
电池输入 -> AMS1117-3.3 -> 3.3V系统供电
         -> 充电管理IC -> 电池充电
```

### 核心连接
```
STM32F103C8T6 引脚分配:
PA4  -> ADXL345_SCL
PA5  -> ADXL345_SDA
PA9  -> ESP8266_RX (USART1_TX)
PA10 -> ESP8266_TX (USART1_RX)
PB5  -> MAX30102_INT
PB6  -> OLED_SCL
PB7  -> OLED_SDA
PB8  -> MAX30102_SCL
PB9  -> MAX30102_SDA
PC13 -> Buzzer
```

### IIC总线设计
项目使用多个IIC设备，采用不同的IIC接口避免冲突:
- **硬件IIC1**: 未使用(PB6,PB7作为GPIO模拟IIC)
- **软件IIC1**: MAX30102 (PB8,PB9)
- **软件IIC2**: ADXL345 (PA4,PA5)  
- **软件IIC3**: OLED (PB6,PB7)

## PCB设计要点

### 布局原则
1. **电源与地线**
   - 采用多层PCB，独立电源层和地层
   - 电源去耦电容靠近IC放置
   - 避免电源与地线形成环路

2. **信号完整性**
   - 高速信号线短且直
   - 避免尖锐转角，使用45°或圆弧
   - 差分信号等长等宽

3. **EMC设计**
   - 晶振周围包地处理
   - 敏感信号远离开关电源
   - PCB边缘倒角处理

### 关键设计
1. **天线设计**
   - ESP8266天线区域保持净空
   - 天线下方不走线，不覆铜

2. **传感器布局**
   - MAX30102需要避光设计
   - ADXL345远离振动源
   - OLED排针预留调试空间

## 机械结构

### 外壳设计
- **材质**: ABS塑料或PC材质
- **尺寸**: 约40mm × 35mm × 12mm
- **重量**: < 30g (含电池)
- **防护等级**: IP54 (防尘防溅水)

### 人机交互
- **表带**: 硅胶材质，可调节长度
- **按键**: 触摸按键或单个物理按键
- **充电**: Micro USB或磁吸充电

### 佩戴要求
- **佩戴位置**: 手腕内侧，贴近皮肤
- **佩戴松紧**: 适中，确保传感器接触良好
- **使用环境**: 
  - 工作温度: 0°C ~ 50°C
  - 存储温度: -20°C ~ 70°C
  - 湿度: 10% ~ 90% RH

## 电源管理

### 电池规格
- **类型**: 锂聚合物电池
- **电压**: 3.7V标称电压
- **容量**: 300-500mAh
- **尺寸**: 根据外壳空间确定
- **保护**: 内置过充、过放、短路保护

### 充电设计
- **充电方式**: 5V USB充电
- **充电电流**: 100-500mA
- **充电指示**: LED指示灯
- **充电时间**: 2-3小时

### 功耗分析
```
工作状态功耗估算:
- STM32正常运行: ~20mA
- MAX30102工作: ~1mA
- ADXL345工作: ~0.15mA
- OLED显示: ~20mA
- ESP8266发送: ~170mA (瞬时)
- ESP8266待机: ~1mA

总平均功耗: ~50mA
电池续航: 300mAh / 50mA = 6小时连续使用
```

### 低功耗优化
1. **MCU睡眠模式**: 无操作时进入睡眠
2. **传感器功耗管理**: 按需启动传感器
3. **显示屏管理**: 定时关闭显示屏
4. **WiFi管理**: 间歇性数据传输

## 测试与验证

### 硬件测试
1. **电源测试**
   - 电压稳定性测试
   - 功耗测试
   - 纹波测试

2. **通信测试**
   - IIC通信时序测试
   - UART通信测试
   - WiFi连接测试

3. **传感器测试**
   - MAX30102信号质量测试
   - ADXL345精度测试
   - OLED显示测试

### 可靠性测试
1. **环境测试**
   - 温度循环测试
   - 湿度测试
   - 振动测试

2. **老化测试**
   - 长时间运行测试
   - 电池循环测试
   - 按键寿命测试

## 生产工艺

### SMT贴片
- **钢网厚度**: 0.12mm
- **回流焊接**: 标准无铅工艺
- **检测**: AOI + ICT测试

### 组装工艺
1. **PCB组装**: SMT + 插件焊接
2. **功能测试**: 上电检测各功能模块
3. **外壳组装**: 安装电池、外壳、表带
4. **最终测试**: 整机功能验证

## 故障排除

### 常见硬件问题
1. **设备不开机**
   - 检查电池电压
   - 检查电源开关
   - 检查充电电路

2. **传感器无数据**
   - 检查IIC连接
   - 检查传感器供电
   - 检查上拉电阻

3. **WiFi连接失败**
   - 检查ESP8266供电
   - 检查天线连接
   - 检查UART通信

4. **显示异常**
   - 检查OLED供电
   - 检查IIC时序
   - 检查对比度设置

## 改进方向

### 硬件升级
1. **更高集成度**: 使用集成度更高的芯片
2. **更小尺寸**: 优化PCB布局，减小整体尺寸
3. **更长续航**: 使用更大容量电池和低功耗设计
4. **更多功能**: 增加GPS、NFC等功能模块

### 工艺改进
1. **防水性能**: 提升防护等级到IP67
2. **材质升级**: 使用更好的表带材质
3. **快速充电**: 支持无线充电或快充技术

---

## 相关文档

- [README.md](README.md) - 项目概述
- [DEVELOPMENT.md](DEVELOPMENT.md) - 开发文档
- [CONTRIBUTING.md](CONTRIBUTING.md) - 贡献指南

---

<div align="center">

**设计者**: 謝懿Shine  
**文档版本**: 1.0.0  
**最后更新**: 2025-01-03

**⚠️ 注意**: 本文档仅供参考，实际生产时请根据具体需求调整设计参数。

</div>
